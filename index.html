<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DENEME KAFE | QR Men√º</title>

  <style>
    :root {
      --bg: #070A10;
      --bg2: #0B1020;
      --card: rgba(255,255,255,0.06);
      --card2: rgba(255,255,255,0.09);
      --border: rgba(255,255,255,0.10);

      --text: #f8fafc;
      --muted: rgba(248,250,252,0.72);

      --primary: #ff2ea6;
      --primary2: #ff7a00;
      --accent: #00f5d4;
      --accent2: #7cff6b;

      --shadow: 0 18px 60px rgba(0,0,0,0.55);

      --radius: 22px;
    }

    body.light {
      --bg: #f7f7fb;
      --bg2: #ffffff;
      --card: rgba(0,0,0,0.04);
      --card2: rgba(0,0,0,0.06);
      --border: rgba(0,0,0,0.10);

      --text: #0b0f14;
      --muted: rgba(11,15,20,0.70);

      --shadow: 0 18px 50px rgba(0,0,0,0.12);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", Arial, sans-serif;
    }

    body {
      background: radial-gradient(circle at 20% 20%, rgba(255,46,166,0.20), transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(0,245,212,0.20), transparent 55%),
                  radial-gradient(circle at 40% 90%, rgba(255,122,0,0.18), transparent 55%),
                  linear-gradient(180deg, var(--bg), var(--bg2));
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ---------- HEADER ---------- */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      transition: transform 0.35s ease;
    }

    body.light header {
      background: rgba(255,255,255,0.75);
    }

    header.hide {
      transform: translateY(-120%);
    }

    .header-inner {
      max-width: 1100px;
      margin: auto;
      padding: 16px 18px 18px;
    }

    .top-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .lang-area {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .lang-btn {
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--muted);
      font-weight: 700;
      font-size: 12px;
      padding: 9px 12px;
      border-radius: 999px;
      cursor: pointer;
      transition: 0.2s;
    }

    .lang-btn.active {
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      color: white;
      border: none;
      box-shadow: 0 12px 30px rgba(255,46,166,0.20);
    }

    .mode-btn {
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      font-weight: 700;
      font-size: 12px;
      padding: 9px 12px;
      border-radius: 999px;
      cursor: pointer;
      transition: 0.2s;
    }

    .mode-btn:hover {
      transform: scale(1.05);
    }

    .center-brand {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 10px;
    }

    .logo-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .logo-wrap img {
      width: 64px;
      height: 64px;
      border-radius: 18px;
      object-fit: cover;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      box-shadow: var(--shadow);
    }

    .brand-text h1 {
      font-size: 24px;
      font-weight: 900;
      letter-spacing: 0.5px;
      background: linear-gradient(90deg, var(--primary), var(--primary2), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .brand-text p {
      font-size: 13px;
      font-weight: 600;
      color: var(--muted);
      margin-top: 3px;
    }

    .search-area {
      margin-top: 18px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .search-area input {
      width: 100%;
      max-width: 520px;
      padding: 14px 16px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      outline: none;
      font-size: 14px;
      transition: 0.2s;
    }

    body.light .search-area input {
      background: rgba(0,0,0,0.04);
    }

    .search-area input:focus {
      border-color: rgba(255,46,166,0.7);
      box-shadow: 0 0 0 4px rgba(255,46,166,0.15);
    }

    .tagline {
      margin-top: 12px;
      text-align: center;
      font-weight: 800;
      font-size: 13px;
      letter-spacing: 0.6px;
      color: var(--muted);
    }

    /* ---------- CATEGORIES ---------- */
    .categories {
      margin-top: 18px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .cat-btn {
      padding: 11px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--muted);
      cursor: pointer;
      font-weight: 700;
      font-size: 13px;
      transition: 0.2s;
    }

    .cat-btn:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.20);
    }

    .cat-btn.active {
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      color: white;
      border: none;
      box-shadow: 0 14px 35px rgba(255,46,166,0.18);
    }

    /* ---------- MAIN ---------- */
    .container {
      max-width: 1100px;
      margin: auto;
      padding: 18px;
    }

    .section-title {
      margin-top: 20px;
      margin-bottom: 14px;
      font-weight: 900;
      font-size: 16px;
      letter-spacing: 0.5px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title span {
      background: linear-gradient(90deg, var(--accent), var(--primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* ---------- SLIDER ---------- */
    .slider {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--card);
      box-shadow: var(--shadow);
    }

    .slider-track {
      display: flex;
      transition: transform 0.6s ease;
    }

    .slide {
      min-width: 100%;
      padding: 18px;
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .slide img {
      width: 140px;
      height: 140px;
      border-radius: 18px;
      object-fit: cover;
      border: 1px solid var(--border);
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
      filter: saturate(1.25) contrast(1.1);
    }

    .slide-text h3 {
      font-size: 18px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .slide-text p {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
      margin-bottom: 10px;
    }

    .price-row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .old-price {
      text-decoration: line-through;
      opacity: 0.6;
      font-weight: 800;
    }

    .new-price {
      font-size: 18px;
      font-weight: 900;
      color: var(--accent2);
    }

    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 11px;
      background: rgba(255,46,166,0.16);
      border: 1px solid rgba(255,46,166,0.30);
      color: var(--primary);
    }

    .slider-dots {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.25);
      cursor: pointer;
      transition: 0.2s;
    }

    .dot.active {
      background: var(--primary);
      transform: scale(1.2);
    }

    /* ---------- FAVORITE ---------- */
    .favorite-card {
      display: flex;
      gap: 16px;
      align-items: center;
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.04));
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: 0.2s;
    }

    .favorite-card:hover {
      transform: translateY(-3px);
      border-color: rgba(0,245,212,0.35);
    }

    .favorite-card img {
      width: 120px;
      height: 120px;
      border-radius: 18px;
      object-fit: cover;
      border: 1px solid var(--border);
      filter: saturate(1.3) contrast(1.1);
    }

    .favorite-info h3 {
      font-size: 16px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .favorite-info p {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.4;
      margin-bottom: 10px;
    }

    /* ---------- GRID ---------- */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 14px;
    }

    .product-card {
      border-radius: var(--radius);
      border: 1px solid var(--border);
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03));
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: 0.2s;
    }

    .product-card:hover {
      transform: translateY(-4px);
      border-color: rgba(255,46,166,0.45);
    }

    .product-img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      filter: saturate(1.35) contrast(1.1);
      background: rgba(255,255,255,0.06);
    }

    .product-body {
      padding: 14px;
    }

    .product-top {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: flex-start;
    }

    .product-body h3 {
      font-size: 15px;
      font-weight: 900;
      margin-bottom: 6px;
    }

    .product-body p {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
      margin-bottom: 10px;
    }

    .price {
      font-size: 14px;
      font-weight: 900;
      background: linear-gradient(90deg, var(--accent), var(--primary2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      white-space: nowrap;
    }

    .mini-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .mini-tag {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 800;
      background: rgba(0,245,212,0.14);
      border: 1px solid rgba(0,245,212,0.25);
      color: var(--accent);
    }

    .mini-tag.hot {
      background: rgba(255,122,0,0.16);
      border: 1px solid rgba(255,122,0,0.25);
      color: var(--primary2);
    }

    /* ---------- WHATSAPP ---------- */
    .whatsapp {
      position: fixed;
      bottom: 16px;
      right: 16px;
      background: linear-gradient(90deg, #25D366, #18a84c);
      color: white;
      padding: 14px 16px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 13px;
      text-decoration: none;
      box-shadow: 0 12px 40px rgba(0,0,0,0.45);
      transition: 0.2s;
      z-index: 200;
    }

    .whatsapp:hover {
      transform: scale(1.07);
    }

    /* ---------- FOOTER ---------- */
    footer {
      margin-top: 40px;
      padding: 18px;
      border-top: 1px solid var(--border);
      text-align: center;
      color: var(--muted);
      font-weight: 700;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    footer a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 900;
      cursor: pointer;
    }

    /* ---------- MODALS ---------- */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 16px;
    }

    body.light .modal-overlay {
      background: rgba(0,0,0,0.35);
    }

    .modal {
      width: 100%;
      max-width: 900px;
      border-radius: 26px;
      border: 1px solid var(--border);
      background: rgba(15,20,35,0.92);
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
      animation: pop 0.25s ease;
    }

    body.light .modal {
      background: rgba(255,255,255,0.92);
    }

    @keyframes pop {
      from { transform: scale(0.96); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .modal-header {
      padding: 14px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
    }

    .modal-header h2 {
      font-size: 15px;
      font-weight: 900;
      letter-spacing: 0.3px;
    }

    .close-btn {
      border: none;
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--border);
      color: var(--text);
      width: 40px;
      height: 40px;
      border-radius: 14px;
      font-size: 18px;
      cursor: pointer;
      font-weight: 900;
    }

    .modal-body {
      padding: 16px;
      max-height: 78vh;
      overflow-y: auto;
    }

    /* ---------- PRODUCT DETAIL ---------- */
    .detail-wrap {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media(max-width: 820px){
      .detail-wrap {
        grid-template-columns: 1fr;
      }
    }

    .detail-img {
      width: 100%;
      border-radius: 22px;
      border: 1px solid var(--border);
      object-fit: contain;
      background: rgba(0,0,0,0.25);
      max-height: 380px;
    }

    body.light .detail-img {
      background: rgba(0,0,0,0.04);
    }

    .detail-info h3 {
      font-size: 18px;
      font-weight: 900;
      margin-bottom: 8px;
    }

    .detail-info p {
      color: var(--muted);
      line-height: 1.6;
      font-size: 13px;
      margin-bottom: 14px;
    }

    .detail-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 14px;
    }

    .detail-box {
      padding: 12px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
    }

    .detail-box span {
      display: block;
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
      font-weight: 800;
    }

    .detail-box strong {
      font-size: 13px;
      font-weight: 900;
    }

    .order-btn {
      width: 100%;
      padding: 14px;
      border-radius: 18px;
      border: none;
      cursor: pointer;
      font-weight: 900;
      font-size: 14px;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      color: white;
      box-shadow: 0 18px 40px rgba(255,46,166,0.22);
      transition: 0.2s;
    }

    .order-btn:hover {
      transform: scale(1.03);
    }

    /* ---------- ADMIN PANEL ---------- */
    .admin-section {
      margin-bottom: 22px;
      padding: 14px;
      border-radius: 22px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
    }

    .admin-section h3 {
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 10px;
      background: linear-gradient(90deg, var(--accent), var(--primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .admin-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .admin-row input,
    .admin-row textarea,
    .admin-row select {
      flex: 1;
      min-width: 220px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      outline: none;
      font-size: 13px;
    }

    body.light .admin-row input,
    body.light .admin-row textarea,
    body.light .admin-row select {
      background: rgba(0,0,0,0.04);
    }

    textarea {
      resize: vertical;
      min-height: 90px;
    }

    .admin-btn {
      padding: 12px 14px;
      border-radius: 16px;
      border: none;
      cursor: pointer;
      font-weight: 900;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      color: white;
      transition: 0.2s;
    }

    .admin-btn:hover {
      transform: scale(1.03);
    }

    .admin-btn.gray {
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--border);
      color: var(--text);
    }

    .admin-btn.red {
      background: linear-gradient(90deg, #ff2e2e, #ff7a00);
    }

    .admin-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 12px;
    }

    .admin-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      flex-wrap: wrap;
    }

    .admin-item strong {
      font-size: 13px;
      font-weight: 900;
    }

    .admin-item span {
      font-size: 12px;
      color: var(--muted);
      font-weight: 800;
    }

    .admin-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* ---------- LOGIN ---------- */
    .login-box {
      padding: 18px;
      border-radius: 22px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
    }

    .login-box input {
      width: 100%;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      outline: none;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .hint {
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
    }

  </style>
</head>

<body>

<header id="mainHeader">
  <div class="header-inner">
    <div class="top-row">
      <div style="opacity:0.8;font-weight:900;font-size:12px;letter-spacing:0.6px;color:var(--muted);">
        QR MENU
      </div>

      <div class="lang-area">
        <button class="lang-btn active" id="btnTR">TR</button>
        <button class="lang-btn" id="btnEN">EN</button>
        <button class="mode-btn" id="modeBtn">üåô</button>
      </div>
    </div>

    <div class="center-brand">
      <div class="logo-wrap">
        <img id="cafeLogo" src="logo.png" alt="Logo" onerror="this.style.display='none'">
        <div class="brand-text">
          <h1 id="cafeName">DENEME KAFE</h1>
          <p id="cafeSub">Tatlƒ± ‚Ä¢ Tuzlu ‚Ä¢ Kahve ‚Ä¢ Mutluluk</p>
        </div>
      </div>

      <div class="search-area">
        <input type="text" id="searchInput" placeholder="√úr√ºn ara...">
      </div>

      <div class="categories" id="categoryButtons"></div>

      <div class="tagline" id="subtitleText">
        Bug√ºn kendini ≈üƒ±martma zamanƒ± ‚ú®
      </div>
    </div>
  </div>
</header>

<div class="container">

  <div id="topSections"></div>

  <div class="section-title">
    <span id="menuTitle">Men√º</span>
  </div>

  <div class="grid" id="menuGrid"></div>

</div>

<a class="whatsapp" id="whatsappBtn" href="https://wa.me/905555555555" target="_blank">
  WhatsApp Sipari≈ü
</a>

<footer>
  <div>¬© 2026 <b id="footerCafe">DENEME KAFE</b> | QR Men√º</div>
  <div><a id="adminLink">Admin Panel</a></div>
</footer>

<!-- PRODUCT DETAIL MODAL -->
<div class="modal-overlay" id="productModalOverlay">
  <div class="modal">
    <div class="modal-header">
      <h2 id="productModalTitle">√úr√ºn Detayƒ±</h2>
      <button class="close-btn" onclick="closeProductModal()">‚úï</button>
    </div>
    <div class="modal-body" id="productModalBody"></div>
  </div>
</div>

<!-- ADMIN MODAL -->
<div class="modal-overlay" id="adminModalOverlay">
  <div class="modal">
    <div class="modal-header">
      <h2 id="adminTitle">Admin Panel</h2>
      <button class="close-btn" onclick="closeAdminModal()">‚úï</button>
    </div>
    <div class="modal-body" id="adminBody"></div>
  </div>
</div>

<script>
/* ==============================
   STORAGE HELPERS
============================== */
function save(key, val){
  localStorage.setItem(key, JSON.stringify(val));
}
function load(key, fallback){
  try {
    const val = JSON.parse(localStorage.getItem(key));
    return val ?? fallback;
  } catch {
    return fallback;
  }
}

/* ==============================
   DEFAULT DATA
============================== */
const defaultCategories = [
  { id: "all", tr: "T√ºm√º", en: "All", fixed: true },
  { id: "campaign", tr: "Kampanya", en: "Deals", fixed: true },
  { id: "sweet", tr: "Tatlƒ±", en: "Desserts" },
  { id: "salty", tr: "Tuzlu", en: "Savory" },
  { id: "coffee", tr: "Kahve", en: "Coffee" },
  { id: "drinks", tr: "ƒ∞√ßecek", en: "Drinks" }
];

const defaultProducts = [
  {
    id: crypto.randomUUID(),
    category: "salty",
    isCampaign: false,
    isFavorite: true,
    tr: { name: "Cheddar Burger", desc: "Dana eti, cheddar peyniri, karamelize soƒüan ve √∂zel sos." },
    en: { name: "Cheddar Burger", desc: "Beef patty, cheddar cheese, caramelized onion and signature sauce." },
    price: 220,
    calories: 780,
    prepTime: 12,
    img: "https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=1200&q=80"
  },
  {
    id: crypto.randomUUID(),
    category: "sweet",
    isCampaign: true,
    campaignPrice: 120,
    isFavorite: false,
    tr: { name: "San Sebastian", desc: "Kremamsƒ± i√ß doku, karamelli √ºst katman." },
    en: { name: "San Sebastian", desc: "Creamy texture with caramelized top." },
    price: 150,
    calories: 560,
    prepTime: 8,
    img: "https://images.unsplash.com/photo-1542826438-bd32f43d626f?auto=format&fit=crop&w=1200&q=80"
  },
  {
    id: crypto.randomUUID(),
    category: "coffee",
    isCampaign: true,
    campaignPrice: 95,
    isFavorite: false,
    tr: { name: "Iced Latte", desc: "Espresso + s√ºt + buz. A≈üƒ±rƒ± ferah." },
    en: { name: "Iced Latte", desc: "Espresso + milk + ice. Super refreshing." },
    price: 120,
    calories: 190,
    prepTime: 5,
    img: "https://images.unsplash.com/photo-1517701550927-30cf4ba1dba5?auto=format&fit=crop&w=1200&q=80"
  },
  {
    id: crypto.randomUUID(),
    category: "sweet",
    isCampaign: false,
    isFavorite: false,
    tr: { name: "Brownie", desc: "Sƒ±cacƒ±k brownie, yanƒ±nda vanilyalƒ± dondurma." },
    en: { name: "Brownie", desc: "Warm brownie served with vanilla ice cream." },
    price: 140,
    calories: 620,
    prepTime: 7,
    img: "https://images.unsplash.com/photo-1614707267537-2b3c4c0b5b2b?auto=format&fit=crop&w=1200&q=80"
  },
  {
    id: crypto.randomUUID(),
    category: "drinks",
    isCampaign: false,
    isFavorite: false,
    tr: { name: "Fresh Lemonade", desc: "Taze limon, nane ve doƒüal ≈üeker." },
    en: { name: "Fresh Lemonade", desc: "Fresh lemon, mint and natural sugar." },
    price: 95,
    calories: 140,
    prepTime: 4,
    img: "https://images.unsplash.com/photo-1528823872057-9c018a7d3d26?auto=format&fit=crop&w=1200&q=80"
  }
];

const defaultSettings = {
  cafeName: "DENEME KAFE",
  cafeSub: "Tatlƒ± ‚Ä¢ Tuzlu ‚Ä¢ Kahve ‚Ä¢ Mutluluk",
  whatsapp: "905555555555",
  lang: "tr",
  theme: "dark",
  adminPassword: "1234",
  logoData: null
};

/* ==============================
   LOAD STATE
============================== */
let settings = load("qr_settings", defaultSettings);
let categories = load("qr_categories", defaultCategories);
let products = load("qr_products", defaultProducts);

let currentLang = settings.lang || "tr";
let currentCategory = "all";

/* ==============================
   TRANSLATIONS
============================== */
const translations = {
  tr: {
    menu: "Men√º",
    search: "√úr√ºn ara... (√∂rn: latte, burger)",
    campaignTitle: "üî• Kampanyalar",
    favoriteTitle: "‚≠ê G√ºn√ºn Favorisi",
    detail: "√úr√ºn Detayƒ±",
    calories: "Kalori",
    time: "Hazƒ±rlama S√ºresi",
    price: "Fiyat",
    order: "WhatsApp'tan Sipari≈ü Ver",
    admin: "Admin Panel",
    login: "Admin Giri≈ü",
    password: "≈ûifre",
    loginBtn: "Giri≈ü Yap",
    wrongPass: "≈ûifre yanlƒ±≈ü!",
    addProduct: "√úr√ºn Ekle / D√ºzenle",
    save: "Kaydet",
    reset: "Formu Temizle",
    delete: "Sil",
    edit: "D√ºzenle",
    category: "Kategori",
    name: "√úr√ºn Adƒ±",
    desc: "A√ßƒ±klama",
    img: "√úr√ºn G√∂rseli",
    priceNormal: "Normal Fiyat",
    priceCampaign: "Kampanya Fiyatƒ± (varsa)",
    isCampaign: "Kampanya √úr√ºn√º m√º?",
    isFavorite: "G√ºn√ºn Favorisi mi?",
    adminSettings: "Kafe Ayarlarƒ±",
    cafeName: "Kafe ƒ∞smi",
    cafeSub: "Slogan",
    whatsappNum: "WhatsApp Numara",
    uploadLogo: "Logo Y√ºkle",
    changePass: "≈ûifre Deƒüi≈ütir",
    newPass: "Yeni ≈ûifre",
    changeBtn: "≈ûifreyi G√ºncelle",
    manageCats: "Kategori Y√∂netimi",
    addCat: "Yeni Kategori Ekle",
    catNameTR: "Kategori TR",
    catNameEN: "Kategori EN",
    moveUp: "Yukarƒ±",
    moveDown: "A≈üaƒüƒ±",
    close: "Kapat"
  },
  en: {
    menu: "Menu",
    search: "Search item... (ex: latte, burger)",
    campaignTitle: "üî• Deals",
    favoriteTitle: "‚≠ê Today's Favorite",
    detail: "Product Detail",
    calories: "Calories",
    time: "Prep Time",
    price: "Price",
    order: "Order via WhatsApp",
    admin: "Admin Panel",
    login: "Admin Login",
    password: "Password",
    loginBtn: "Login",
    wrongPass: "Wrong password!",
    addProduct: "Add / Edit Product",
    save: "Save",
    reset: "Clear Form",
    delete: "Delete",
    edit: "Edit",
    category: "Category",
    name: "Product Name",
    desc: "Description",
    img: "Product Image",
    priceNormal: "Normal Price",
    priceCampaign: "Campaign Price (if any)",
    isCampaign: "Campaign Product?",
    isFavorite: "Today's Favorite?",
    adminSettings: "Cafe Settings",
    cafeName: "Cafe Name",
    cafeSub: "Slogan",
    whatsappNum: "WhatsApp Number",
    uploadLogo: "Upload Logo",
    changePass: "Change Password",
    newPass: "New Password",
    changeBtn: "Update Password",
    manageCats: "Category Management",
    addCat: "Add New Category",
    catNameTR: "Category TR",
    catNameEN: "Category EN",
    moveUp: "Up",
    moveDown: "Down",
    close: "Close"
  }
};

/* ==============================
   THEME
============================== */
function applyTheme(){
  if(settings.theme === "light"){
    document.body.classList.add("light");
    document.getElementById("modeBtn").innerText = "‚òÄÔ∏è";
  } else {
    document.body.classList.remove("light");
    document.getElementById("modeBtn").innerText = "üåô";
  }
}

document.getElementById("modeBtn").addEventListener("click", () => {
  settings.theme = settings.theme === "dark" ? "light" : "dark";
  save("qr_settings", settings);
  applyTheme();
});

/* ==============================
   LANGUAGE
============================== */
function setLang(lang){
  currentLang = lang;
  settings.lang = lang;
  save("qr_settings", settings);

  document.getElementById("btnTR").classList.toggle("active", lang === "tr");
  document.getElementById("btnEN").classList.toggle("active", lang === "en");

  document.getElementById("menuTitle").innerText = translations[lang].menu;
  document.getElementById("searchInput").placeholder = translations[lang].search;
  document.getElementById("productModalTitle").innerText = translations[lang].detail;
  document.getElementById("adminTitle").innerText = translations[lang].admin;

  renderCategories();
  renderTopSections();
  renderProducts();
}

document.getElementById("btnTR").addEventListener("click", () => setLang("tr"));
document.getElementById("btnEN").addEventListener("click", () => setLang("en"));

/* ==============================
   SETTINGS APPLY
============================== */
function applySettings(){
  document.getElementById("cafeName").innerText = settings.cafeName;
  document.getElementById("footerCafe").innerText = settings.cafeName;
  document.getElementById("cafeSub").innerText = settings.cafeSub;

  document.getElementById("whatsappBtn").href = "https://wa.me/" + settings.whatsapp;

  if(settings.logoData){
    const logo = document.getElementById("cafeLogo");
    logo.src = settings.logoData;
    logo.style.display = "block";
  }
}

/* ==============================
   HEADER AUTO HIDE
============================== */
let lastScroll = 0;
window.addEventListener("scroll", () => {
  const current = window.scrollY;
  const header = document.getElementById("mainHeader");

  if(current > lastScroll && current > 150){
    header.classList.add("hide");
  } else {
    header.classList.remove("hide");
  }
  lastScroll = current;
});

/* ==============================
   CATEGORIES
============================== */
function renderCategories(){
  const div = document.getElementById("categoryButtons");
  div.innerHTML = "";

  categories.forEach(cat => {
    const btn = document.createElement("button");
    btn.className = "cat-btn";
    btn.innerText = currentLang === "tr" ? cat.tr : cat.en;

    if(currentCategory === cat.id) btn.classList.add("active");

    btn.onclick = () => {
      currentCategory = cat.id;
      renderCategories();
      renderTopSections();
      renderProducts();
    };

    div.appendChild(btn);
  });
}

/* ==============================
   TOP SECTIONS (CAMPAIGN + FAVORITE)
============================== */
let sliderIndex = 0;
let sliderTimer = null;

function renderTopSections(){
  const wrap = document.getElementById("topSections");
  wrap.innerHTML = "";

  // sadece T√ºm√º se√ßiliyken √ºstte g√∂z√ºks√ºn
  if(currentCategory !== "all"){
    return;
  }

  const campaignItems = products.filter(p => p.isCampaign);
  const favoriteItem = products.find(p => p.isFavorite);

  // Campaign Slider
  if(campaignItems.length > 0){
    const secTitle = document.createElement("div");
    secTitle.className = "section-title";
    secTitle.innerHTML = `<span>${translations[currentLang].campaignTitle}</span>`;
    wrap.appendChild(secTitle);

    const slider = document.createElement("div");
    slider.className = "slider";

    const track = document.createElement("div");
    track.className = "slider-track";

    campaignItems.forEach(item => {
      const slide = document.createElement("div");
      slide.className = "slide";

      const name = item[currentLang].name;
      const desc = item[currentLang].desc;

      slide.innerHTML = `
        <img src="${item.img}">
        <div class="slide-text">
          <div class="badge">KAMPANYA</div>
          <h3>${name}</h3>
          <p>${desc}</p>
          <div class="price-row">
            <div class="old-price">${item.price}‚Ç∫</div>
            <div class="new-price">${item.campaignPrice || item.price}‚Ç∫</div>
          </div>
        </div>
      `;

      slide.onclick = () => openProductModal(item.id);

      track.appendChild(slide);
    });

    slider.appendChild(track);

    // Dots
    const dots = document.createElement("div");
    dots.className = "slider-dots";

    campaignItems.forEach((_, i) => {
      const dot = document.createElement("div");
      dot.className = "dot";
      if(i === sliderIndex) dot.classList.add("active");

      dot.onclick = () => {
        sliderIndex = i;
        updateSlider();
      };

      dots.appendChild(dot);
    });

    slider.appendChild(dots);
    wrap.appendChild(slider);

    function updateSlider(){
      track.style.transform = `translateX(-${sliderIndex * 100}%)`;
      dots.querySelectorAll(".dot").forEach((d, i) => {
        d.classList.toggle("active", i === sliderIndex);
      });
    }

    updateSlider();

    clearInterval(sliderTimer);
    sliderTimer = setInterval(() => {
      sliderIndex = (sliderIndex + 1) % campaignItems.length;
      updateSlider();
    }, 4000);
  }

  // Favorite
  if(favoriteItem){
    const secTitle = document.createElement("div");
    secTitle.className = "section-title";
    secTitle.innerHTML = `<span>${translations[currentLang].favoriteTitle}</span>`;
    wrap.appendChild(secTitle);

    const fav = document.createElement("div");
    fav.className = "favorite-card";

    fav.innerHTML = `
      <img src="${favoriteItem.img}">
      <div class="favorite-info">
        <div class="badge">√ñNERƒ∞</div>
        <h3>${favoriteItem[currentLang].name}</h3>
        <p>${favoriteItem[currentLang].desc}</p>
        <div class="price-row">
          <div class="new-price">${favoriteItem.price}‚Ç∫</div>
        </div>
      </div>
    `;

    fav.onclick = () => openProductModal(favoriteItem.id);
    wrap.appendChild(fav);
  }
}

/* ==============================
   PRODUCTS RENDER
============================== */
function renderProducts(){
  const grid = document.getElementById("menuGrid");
  grid.innerHTML = "";

  const searchVal = document.getElementById("searchInput").value.toLowerCase();

  let filtered = products.filter(p => {
    const name = p[currentLang].name.toLowerCase();
    const desc = p[currentLang].desc.toLowerCase();
    const matchesSearch = name.includes(searchVal) || desc.includes(searchVal);

    if(currentCategory === "all"){
      return matchesSearch;
    }

    if(currentCategory === "campaign"){
      return p.isCampaign && matchesSearch;
    }

    // kampanya √ºr√ºnleri sadece kampanya ve t√ºm√ºnde g√∂z√ºks√ºn
    if(p.isCampaign) return false;

    return p.category === currentCategory && matchesSearch;
  });

  filtered.forEach(item => {
    const card = document.createElement("div");
    card.className = "product-card";

    const name = item[currentLang].name;
    const desc = item[currentLang].desc;

    let priceHTML = `<div class="price">${item.price}‚Ç∫</div>`;
    if(item.isCampaign){
      priceHTML = `
        <div class="price">
          <span style="text-decoration:line-through;opacity:0.6;font-weight:800;">${item.price}‚Ç∫</span>
          <span style="margin-left:8px;">${item.campaignPrice || item.price}‚Ç∫</span>
        </div>
      `;
    }

    card.innerHTML = `
      <img class="product-img" src="${item.img}" alt="">
      <div class="product-body">
        <div class="product-top">
          <div>
            <h3>${name}</h3>
            <p>${desc}</p>
          </div>
          ${priceHTML}
        </div>

        <div class="mini-row">
          <span class="mini-tag">${item.prepTime} dk</span>
          <span class="mini-tag hot">${item.calories} kcal</span>
        </div>
      </div>
    `;

    card.onclick = () => openProductModal(item.id);
    grid.appendChild(card);
  });
}

document.getElementById("searchInput").addEventListener("input", () => {
  renderTopSections();
  renderProducts();
});

/* ==============================
   PRODUCT MODAL
============================== */
function openProductModal(id){
  const item = products.find(p => p.id === id);
  if(!item) return;

  const overlay = document.getElementById("productModalOverlay");
  overlay.style.display = "flex";

  const body = document.getElementById("productModalBody");

  const name = item[currentLang].name;
  const desc = item[currentLang].desc;

  let price = `${item.price}‚Ç∫`;
  if(item.isCampaign){
    price = `${item.campaignPrice || item.price}‚Ç∫ (Kampanya)`;
  }

  const msg = encodeURIComponent(`Merhaba! ${settings.cafeName} men√ºs√ºnden "${name}" sipari≈ü vermek istiyorum üòä`);
  const waLink = `https://wa.me/${settings.whatsapp}?text=${msg}`;

  body.innerHTML = `
    <div class="detail-wrap">
      <div>
        <img class="detail-img" src="${item.img}">
      </div>
      <div class="detail-info">
        <h3>${name}</h3>
        <p>${desc}</p>

        <div class="detail-grid">
          <div class="detail-box">
            <span>${translations[currentLang].price}</span>
            <strong>${price}</strong>
          </div>
          <div class="detail-box">
            <span>${translations[currentLang].time}</span>
            <strong>${item.prepTime} dk</strong>
          </div>
          <div class="detail-box">
            <span>${translations[currentLang].calories}</span>
            <strong>${item.calories} kcal</strong>
          </div>
          <div class="detail-box">
            <span>${translations[currentLang].category}</span>
            <strong>${getCategoryName(item.category)}</strong>
          </div>
        </div>

        <button class="order-btn" onclick="window.open('${waLink}','_blank')">
          ${translations[currentLang].order}
        </button>
      </div>
    </div>
  `;
}

function closeProductModal(){
  document.getElementById("productModalOverlay").style.display = "none";
}

/* ==============================
   CATEGORY NAME
============================== */
function getCategoryName(catId){
  const cat = categories.find(c => c.id === catId);
  if(!cat) return catId;
  return currentLang === "tr" ? cat.tr : cat.en;
}

/* ==============================
   ADMIN PANEL
============================== */
document.getElementById("adminLink").addEventListener("click", () => {
  openAdminModal();
});

function openAdminModal(){
  document.getElementById("adminModalOverlay").style.display = "flex";
  renderAdminLogin();
}

function closeAdminModal(){
  document.getElementById("adminModalOverlay").style.display = "none";
}

function renderAdminLogin(){
  const adminBody = document.getElementById("adminBody");

  adminBody.innerHTML = `
    <div class="login-box">
      <h3 style="font-size:16px;font-weight:900;margin-bottom:12px;">${translations[currentLang].login}</h3>
      <input id="adminPassInput" type="password" placeholder="${translations[currentLang].password}">
      <button class="admin-btn" style="width:100%;" onclick="adminLogin()">${translations[currentLang].loginBtn}</button>
      <div class="hint">Varsayƒ±lan ≈üifre: 1234 (Admin panelden deƒüi≈ütirebilirsin)</div>
    </div>
  `;

  document.getElementById("adminPassInput").value = "";
}

function adminLogin(){
  const val = document.getElementById("adminPassInput").value;

  if(val !== settings.adminPassword){
    alert(translations[currentLang].wrongPass);
    return;
  }

  renderAdminPanel();
}

let editingId = null;
let editingImageData = null;

function renderAdminPanel(){
  const adminBody = document.getElementById("adminBody");

  adminBody.innerHTML = `
    <div class="admin-section">
      <h3>${translations[currentLang].adminSettings}</h3>

      <div class="admin-row">
        <input id="setCafeName" placeholder="${translations[currentLang].cafeName}" value="${settings.cafeName}">
        <input id="setCafeSub" placeholder="${translations[currentLang].cafeSub}" value="${settings.cafeSub}">
      </div>

      <div class="admin-row">
        <input id="setWhatsapp" placeholder="${translations[currentLang].whatsappNum}" value="${settings.whatsapp}">
      </div>

      <div class="admin-row">
        <label style="font-weight:900;color:var(--muted);font-size:12px;">
          ${translations[currentLang].uploadLogo}:
          <input type="file" id="logoUpload" accept="image/*" style="display:block;margin-top:8px;">
        </label>
      </div>

      <div class="admin-row">
        <button class="admin-btn" onclick="saveCafeSettings()">${translations[currentLang].save}</button>
      </div>
    </div>

    <div class="admin-section">
      <h3>${translations[currentLang].manageCats}</h3>

      <div class="admin-row">
        <input id="newCatTR" placeholder="${translations[currentLang].catNameTR}">
        <input id="newCatEN" placeholder="${translations[currentLang].catNameEN}">
        <button class="admin-btn" onclick="addCategory()">${translations[currentLang].addCat}</button>
      </div>

      <div class="admin-list" id="catList"></div>
    </div>

    <div class="admin-section">
      <h3>${translations[currentLang].addProduct}</h3>

      <div class="admin-row">
        <select id="prodCategory"></select>
      </div>

      <div class="admin-row">
        <input id="prodNameTR" placeholder="√úr√ºn Adƒ± (TR)">
        <input id="prodNameEN" placeholder="Product Name (EN)">
      </div>

      <div class="admin-row">
        <textarea id="prodDescTR" placeholder="A√ßƒ±klama (TR)"></textarea>
        <textarea id="prodDescEN" placeholder="Description (EN)"></textarea>
      </div>

      <div class="admin-row">
        <input id="prodPrice" type="number" placeholder="${translations[currentLang].priceNormal}">
        <input id="prodCampaignPrice" type="number" placeholder="${translations[currentLang].priceCampaign}">
      </div>

      <div class="admin-row">
        <input id="prodCalories" type="number" placeholder="Kalori (kcal)">
        <input id="prodPrep" type="number" placeholder="Hazƒ±rlama S√ºresi (dk)">
      </div>

      <div class="admin-row">
        <label style="font-weight:900;color:var(--muted);font-size:12px;">
          ${translations[currentLang].img}:
          <input type="file" id="prodImgUpload" accept="image/*" style="display:block;margin-top:8px;">
        </label>
      </div>

      <div class="admin-row">
        <label style="font-weight:900;color:var(--muted);font-size:12px;">
          <input type="checkbox" id="prodIsCampaign"> ${translations[currentLang].isCampaign}
        </label>

        <label style="font-weight:900;color:var(--muted);font-size:12px;">
          <input type="checkbox" id="prodIsFavorite"> ${translations[currentLang].isFavorite}
        </label>
      </div>

      <div class="admin-row">
        <button class="admin-btn" onclick="saveProduct()">${translations[currentLang].save}</button>
        <button class="admin-btn gray" onclick="resetProductForm()">${translations[currentLang].reset}</button>
      </div>
    </div>

    <div class="admin-section">
      <h3>√úr√ºnler</h3>
      <div class="admin-list" id="productList"></div>
    </div>

    <div class="admin-section">
      <h3>${translations[currentLang].changePass}</h3>
      <div class="admin-row">
        <input id="newPassword" type="password" placeholder="${translations[currentLang].newPass}">
        <button class="admin-btn" onclick="changePassword()">${translations[currentLang].changeBtn}</button>
      </div>
    </div>
  `;

  fillCategorySelect();
  renderProductList();
  renderCategoryList();

  document.getElementById("prodImgUpload").addEventListener("change", handleProductImageUpload);
  document.getElementById("logoUpload").addEventListener("change", handleLogoUpload);
}

function handleLogoUpload(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(){
    settings.logoData = reader.result;
    save("qr_settings", settings);
    applySettings();
  };
  reader.readAsDataURL(file);
}

function saveCafeSettings(){
  const name = document.getElementById("setCafeName").value.trim();
  const sub = document.getElementById("setCafeSub").value.trim();
  const wa = document.getElementById("setWhatsapp").value.trim();

  if(name) settings.cafeName = name;
  if(sub) settings.cafeSub = sub;
  if(wa) settings.whatsapp = wa;

  save("qr_settings", settings);
  applySettings();
  alert("Kaydedildi ‚úÖ");
}

function fillCategorySelect(){
  const select = document.getElementById("prodCategory");
  select.innerHTML = "";

  categories
    .filter(c => c.id !== "all" && c.id !== "campaign")
    .forEach(cat => {
      const opt = document.createElement("option");
      opt.value = cat.id;
      opt.innerText = `${cat.tr} / ${cat.en}`;
      select.appendChild(opt);
    });
}

function handleProductImageUpload(e){
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(){
    editingImageData = reader.result;
    alert("G√∂rsel y√ºklendi ‚úÖ");
  };
  reader.readAsDataURL(file);
}

function resetProductForm(){
  editingId = null;
  editingImageData = null;

  document.getElementById("prodNameTR").value = "";
  document.getElementById("prodNameEN").value = "";
  document.getElementById("prodDescTR").value = "";
  document.getElementById("prodDescEN").value = "";
  document.getElementById("prodPrice").value = "";
  document.getElementById("prodCampaignPrice").value = "";
  document.getElementById("prodCalories").value = "";
  document.getElementById("prodPrep").value = "";
  document.getElementById("prodIsCampaign").checked = false;
  document.getElementById("prodIsFavorite").checked = false;
  document.getElementById("prodImgUpload").value = "";
}

function saveProduct(){
  const cat = document.getElementById("prodCategory").value;

  const nameTR = document.getElementById("prodNameTR").value.trim();
  const nameEN = document.getElementById("prodNameEN").value.trim();

  const descTR = document.getElementById("prodDescTR").value.trim();
  const descEN = document.getElementById("prodDescEN").value.trim();

  const price = Number(document.getElementById("prodPrice").value);
  const campPrice = Number(document.getElementById("prodCampaignPrice").value);

  const calories = Number(document.getElementById("prodCalories").value);
  const prep = Number(document.getElementById("prodPrep").value);

  const isCampaign = document.getElementById("prodIsCampaign").checked;
  const isFavorite = document.getElementById("prodIsFavorite").checked;

  if(!nameTR || !descTR || !price || !calories || !prep){
    alert("L√ºtfen TR adƒ±, TR a√ßƒ±klama, fiyat, kalori ve s√ºre doldur.");
    return;
  }

  if(isFavorite){
    products.forEach(p => p.isFavorite = false);
  }

  const data = {
    id: editingId || crypto.randomUUID(),
    category: cat,
    isCampaign: isCampaign,
    campaignPrice: isCampaign ? (campPrice || price) : null,
    isFavorite: isFavorite,
    tr: { name: nameTR, desc: descTR },
    en: { name: nameEN || nameTR, desc: descEN || descTR },
    price: price,
    calories: calories,
    prepTime: prep,
    img: editingImageData || (editingId ? products.find(p => p.id === editingId)?.img : null)
  };

  if(!data.img){
    alert("L√ºtfen √ºr√ºn g√∂rseli y√ºkle.");
    return;
  }

  if(editingId){
    products = products.map(p => p.id === editingId ? data : p);
  } else {
    products.push(data);
  }

  save("qr_products", products);

  editingId = null;
  editingImageData = null;

  resetProductForm();
  renderProductList();

  renderTopSections();
  renderProducts();

  alert("√úr√ºn kaydedildi ‚úÖ");
}

function renderProductList(){
  const list = document.getElementById("productList");
  list.innerHTML = "";

  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "admin-item";

    div.innerHTML = `
      <div>
        <strong>${p.tr.name}</strong><br>
        <span>${getCategoryName(p.category)} | ${p.price}‚Ç∫ ${p.isCampaign ? "(Kampanya)" : ""} ${p.isFavorite ? "‚≠ê" : ""}</span>
      </div>

      <div class="admin-actions">
        <button class="admin-btn gray" onclick="editProduct('${p.id}')">${translations[currentLang].edit}</button>
        <button class="admin-btn red" onclick="deleteProduct('${p.id}')">${translations[currentLang].delete}</button>
      </div>
    `;

    list.appendChild(div);
  });
}

function editProduct(id){
  const p = products.find(x => x.id === id);
  if(!p) return;

  editingId = id;
  editingImageData = p.img;

  document.getElementById("prodCategory").value = p.category;
  document.getElementById("prodNameTR").value = p.tr.name;
  document.getElementById("prodNameEN").value = p.en.name;
  document.getElementById("prodDescTR").value = p.tr.desc;
  document.getElementById("prodDescEN").value = p.en.desc;
  document.getElementById("prodPrice").value = p.price;
  document.getElementById("prodCampaignPrice").value = p.campaignPrice || "";
  document.getElementById("prodCalories").value = p.calories;
  document.getElementById("prodPrep").value = p.prepTime;
  document.getElementById("prodIsCampaign").checked = p.isCampaign;
  document.getElementById("prodIsFavorite").checked = p.isFavorite;

  alert("D√ºzenleme modu a√ßƒ±ldƒ± ‚ú®");
}

function deleteProduct(id){
  if(!confirm("Silmek istediƒüine emin misin?")) return;

  products = products.filter(p => p.id !== id);
  save("qr_products", products);

  renderProductList();
  renderTopSections();
  renderProducts();
}

function changePassword(){
  const val = document.getElementById("newPassword").value.trim();
  if(val.length < 3){
    alert("≈ûifre en az 3 karakter olmalƒ±.");
    return;
  }

  settings.adminPassword = val;
  save("qr_settings", settings);

  document.getElementById("newPassword").value = "";
  alert("≈ûifre g√ºncellendi ‚úÖ");
}

/* ==============================
   CATEGORY MANAGEMENT
============================== */
function addCategory(){
  const tr = document.getElementById("newCatTR").value.trim();
  const en = document.getElementById("newCatEN").value.trim();

  if(!tr || !en){
    alert("TR ve EN kategori gir.");
    return;
  }

  const id = tr.toLowerCase()
    .replaceAll("ƒ±","i")
    .replaceAll("≈ü","s")
    .replaceAll("ƒü","g")
    .replaceAll("√º","u")
    .replaceAll("√∂","o")
    .replaceAll("√ß","c")
    .replace(/\s+/g,"-");

  if(categories.some(c => c.id === id)){
    alert("Bu kategori zaten var.");
    return;
  }

  categories.push({ id, tr, en });
  save("qr_categories", categories);

  document.getElementById("newCatTR").value = "";
  document.getElementById("newCatEN").value = "";

  fillCategorySelect();
  renderCategoryList();
  renderCategories();
}

function renderCategoryList(){
  const list = document.getElementById("catList");
  list.innerHTML = "";

  categories.forEach((c, index) => {
    if(c.fixed) return;

    const div = document.createElement("div");
    div.className = "admin-item";

    div.innerHTML = `
      <div>
        <strong>${c.tr}</strong><br>
        <span>${c.en}</span>
      </div>

      <div class="admin-actions">
        <button class="admin-btn gray" onclick="moveCategoryUp(${index})">${translations[currentLang].moveUp}</button>
        <button class="admin-btn gray" onclick="moveCategoryDown(${index})">${translations[currentLang].moveDown}</button>
        <button class="admin-btn red" onclick="deleteCategory('${c.id}')">${translations[currentLang].delete}</button>
      </div>
    `;

    list.appendChild(div);
  });
}

function moveCategoryUp(index){
  if(index <= 0) return;
  const item = categories[index];
  const prev = categories[index - 1];

  if(prev.fixed) return;

  categories[index] = prev;
  categories[index - 1] = item;

  save("qr_categories", categories);
  renderCategoryList();
  renderCategories();
  fillCategorySelect();
}

function moveCategoryDown(index){
  if(index >= categories.length - 1) return;

  const item = categories[index];
  const next = categories[index + 1];

  categories[index] = next;
  categories[index + 1] = item;

  save("qr_categories", categories);
  renderCategoryList();
  renderCategories();
  fillCategorySelect();
}

function deleteCategory(id){
  if(!confirm("Kategori silinsin mi? Bu kategoriye ait √ºr√ºnler de g√∂r√ºnmez olur.")) return;

  categories = categories.filter(c => c.id !== id);
  save("qr_categories", categories);

  // o kategoriye ait √ºr√ºnleri de silelim
  products = products.filter(p => p.category !== id);
  save("qr_products", products);

  renderCategoryList();
  renderCategories();
  fillCategorySelect();
  renderProductList();
  renderTopSections();
  renderProducts();
}

/* ==============================
   CLOSE MODAL ON CLICK OUTSIDE
============================== */
document.getElementById("productModalOverlay").addEventListener("click", (e) => {
  if(e.target.id === "productModalOverlay") closeProductModal();
});

document.getElementById("adminModalOverlay").addEventListener("click", (e) => {
  if(e.target.id === "adminModalOverlay") closeAdminModal();
});

/* ==============================
   INIT
============================== */
applyTheme();
applySettings();
renderCategories();
renderTopSections();
renderProducts();
setLang(currentLang);
</script>

</body>
</html>
